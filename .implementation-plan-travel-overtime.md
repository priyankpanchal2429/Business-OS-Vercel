# Travel-Aware Overtime Payroll System - Implementation Plan

## Overview
Implement a comprehensive payroll system that distinguishes between travel days and work days, with specific overtime rules.

## Core Rules

### 1. Travel Days
- **All travel time = regular pay only**
- Never qualifies for overtime, regardless of time
- Examples:
  - 5:00 AM to 7:00 PM travel = all regular hours
  - 11:00 AM to 9:00 PM return travel = all regular hours

### 2. Work Days
- **Regular hours**: Until 6:00 PM
- **Overtime hours**: After 6:00 PM at 1.5x rate
- **Breaks during OT**: Must be excluded from overtime calculation
- Example: 8:00 PM to 9:00 PM break = not counted as OT

### 3. Calculation Logic
- Regular Hours = Work hours before 6:00 PM cutoff
- OT Hours = Work hours after 6:00 PM, minus breaks in OT period
- Total Pay = (Regular Hours × Hourly Rate) + (OT Hours × Hourly Rate × 1.5)

## Implementation Steps

### Phase 1: Database Schema Updates
- [ ] Add `dayType` field to timesheet entries ('Work' | 'Travel')
- [ ] Add `regularHours` and `overtimeHours` fields
- [ ] Add `regularPay` and `overtimePay` fields

### Phase 2: Backend Logic Updates
- [ ] Update `calculateShiftHours()` to accept dayType parameter
- [ ] Implement travel day logic (all hours = regular)
- [ ] Implement work day logic (6 PM cutoff for OT)
- [ ] Update payroll calculation to sum regular and OT pay separately
- [ ] Add calculation breakdown to API responses

### Phase 3: Frontend UI Updates
- [ ] Add "Day Type" dropdown in TimesheetModal (Work/Travel)
- [ ] Update table to show Regular Hours, OT Hours columns
- [ ] Add calculation breakdown section
- [ ] Style travel days differently (e.g., blue badge)
- [ ] Show Total Regular Pay and Total OT Pay

### Phase 4: Payslip Updates
- [ ] Show breakdown of regular vs OT hours
- [ ] Display calculation explanation
- [ ] Show travel days separately from work days

## Technical Details

### Backend Changes
File: `/server/index.js`

**Update calculateShiftHours function:**
```javascript
function calculateShiftHours(startTime, endTime, breakMins, dayType = 'Work', otCutoff = '18:00')
```

**Logic:**
- If dayType === 'Travel': return all minutes as regular, 0 OT
- If dayType === 'Work': calculate based on 6 PM cutoff

### Frontend Changes
File: `/client/src/components/TimesheetModal.jsx`

**Add day type field:**
- Dropdown with options: "Work Day" and "Travel Day"
- Default to "Work Day"
- Blue badge icon for travel days

**Update display:**
- Show regular hours and OT hours separately
- Add calculation explanation tooltip/section

## UI/UX Requirements
✓ Clean, modern layout
✓ Proper spacing and alignment
✓ Intuitive icons (luggage for travel, briefcase for work)
✓ Clear labels and tooltips
✓ Validation for all fields
✓ Real-time calculation preview

## Testing Scenarios
1. Travel day: 5 AM - 7 PM = 14 regular hours, 0 OT
2. Work day with OT: 9 AM - 8 PM (1h break) = 8 regular, 1 OT
3. Work day with break during OT: 9 AM - 10 PM, break 8-9 PM = 9 regular, 2 OT
4. Return travel: 11 AM - 9 PM = 10 regular hours, 0 OT
5. Normal work day: 9 AM - 6 PM = 8 regular, 0 OT
